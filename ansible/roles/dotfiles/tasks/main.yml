---
- name: install git - in order to clone Dotfiles repository
  package: name=git state=latest
  become: yes

- name: install python3 and pip3 - as a dependency of dotfiles
  package: name={{ item }} state=latest
  with_items:
    - python3
    - python3-pip
  become: yes

- name: install dotfiles
  pip:
    name: dotfiles
    executable: pip3
    extra_args: --user

- name: clone Dotfiles repository
  git:
    repo: https://github.com/allgreed/dotfiles.git
    dest: ~/Dotfiles
    version: master
  ignore_errors: yes # added for local ansible files developement - local changes are present in the repository

- name: set remote-push over SSH for Dotfiles repo
  git_config:
    name: remote.origin.pushurl
    scope: local
    value: git@github.com:allgreed/dotfiles.git
    repo: ~/Dotfiles

- name: configure dotfiles
  file:
    src: ~/Dotfiles/dotfilesrc
    dest: ~/.dotfilesrc
    state: link

- name: sync my Dotfiles
  shell: |
    DOTFILES="~/.local/bin/dotfiles"
    TMP_ANSIBLE_DOTFILES_STATUS_CHECK="$(eval $DOTFILES -c)"
    test -z "$TMP_ANSIBLE_DOTFILES_STATUS_CHECK" || eval $DOTFILES --sync --force
    echo $TMP_ANSIBLE_DOTFILES_STATUS_CHECK
  register: command_result
  changed_when: command_result.stdout

