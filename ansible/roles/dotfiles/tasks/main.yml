---
- name: install git - in order to clone Dotfiles repository
  package: name=git state=latest
  become: yes

- name: install python3 and pip3 - as a dependency of dotfiles
  package: name={{ item }} state=latest
  with_items:
    - python3
    - python3-pip
  become: yes

- name: install dotfiles
  pip:
    name: dotfiles
    executable: pip3
    extra_args: --user

- name: clone Dotfiles repository
  git:
    repo: "{{ dotfiles_repo_fetch_url }}"
    dest: ~/Dotfiles
    version: master
  ignore_errors: yes # added for local ansible files developement - local changes are present in the repository

- name: set remote-push over SSH for Dotfiles repo
  git_config:
    name: remote.origin.pushurl
    scope: local
    value: "{{ dotfiles_repo_push_url }}"
    repo: ~/Dotfiles

- name: configure dotfiles
  file:
    src: ~/Dotfiles/dotfilesrc
    dest: ~/.dotfilesrc
    state: link

- name: gather dotfiles check information
  command: "{{ dotfiles_binary }} -c"
  changed_when: False
  register: dotfiles_check_result

- name: sync my Dotfiles
  command: "{{ dotfiles_binary }} --sync --force"
  when: dotfiles_check_result.stdout

